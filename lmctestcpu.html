<!DOCTYPE html>
 <html>
   <boby>
     <p>
       в данном проектируемом ЦПУ память комманд и память данных объединены в один массив RAM <br>
       к адресному входу памяти команд подключен двоичный счётчик, инкрементируемый тактовым сигналом и таким образом
       осуществляющий последовательный перебор команд <br>
       <pre style = "background: #cfffff;">
         counter <= counter + 1;  // инкремент счётчика
       </pre>
     переходы осуществляются загрузкой в счётчик требуемого адреса <br>
     загрузка осуществляется командой <i>counter_load</i> <br>
     <pre style="background: #cfffff;">
       wire [3..0] branch_adr; // адрес перехода
       assign branch_adr = data_in;
       // здесь для примера применяется КМОП таймер +3.3V
       always @(posedge timer555)
       begin
         if (Counter_load) // переход по адресу branch_adr при поступлени команды Counter_load
            counter <= branch_adr; 
          else
            counter <= counter + 1;// инкремент счётчика 
        end
     </pre>
    устройство ввода <i>data_in</i> подключено ко входу двухвходового мультиплексора <i>MUX2</i> <br>
    к другому входу подключен сумматор <i>sum</i>
       <pre style="background: #cfffff;">
        assign sum = Acc + RAM;
       </pre>
    прибавляющий к аккумулятору числа, записанные в память <br>
    выход мультиплексора <i>MUX2</i> подключен к аккумулятору
    <pre style="background: #cfffff;">
     MUX2 = MUX_switch ? sum : data_in;
    </pre>
    аккумулятор - это четырёхбитный регистр <br>
      <pre style="background: #cfffff;">
        module register4
        (
        input [3..0] reg_data,
        input reg_button,
        output reg [3..0] q 
        );
        always @(posedge reg_button)
          q <= reg_data;
        endmodule    
      </pre>
      порты которого подключены к основному модулю
       <pre style="background: #cfffff;">
       register4 Acc_reg(
         .reg_data(MUX2),
         .reg_button(Acc_button),
         .q(Acc)
       );
      </pre>
      модуль и тестбенч находятся <a href="https://github.com/demsp/verilog/blob/master/LMC/R3/">здесь</a> <br>     
      В тестбенче tR3.v производится сложение двух чисел <br>
      &bull; Числа загружаются в RAM <br>       
      &bull; Аккумулятор обнуляется <br>
      &bull; Мультиплексор переключается <br>
      &bull; Первое число загружается из RAM в Acc <br>
      &bull; К этому числу прибавляется второе число <br>
      &bull; Сумма чисел загружается в RAM <br>
      <br>
      в следующем модуле добавляется "вычитатель" <br>
      <pre style="background: #cfffff;">
       wire [3..0] subtract;
       assign subtract = Acc - RAM;
      </pre>
     двухвходовой мультиплексор заменяется четырёхвходовым <br>
        <pre style="background: #cfffff;">     
         always @*
         MUX4 = MUX_switch[1] ? (MUX_switch[0] ? RAM_out : subtract)
           :(MUX_switch[0] ? sum : data_in );
        </pre>
        к аккумулятору подключается устройство вывода <i>data_out</i>, а также флаги <br>
          &bull; Z_flag поднят, если Acc = 0 <br>   
          &bull; PZ_flag поднят, если Acc >= 0 <br>  
        добавляются команды условных переходов <i>Z_JMP</i> и <i>PZ_JMP</i> <br>
        <br>
        <i>Z</i> и <i>PZ</i> "соединяют" флаги и команды (входные сигналы)  <br>
        <pre style="backgroung: #cfffff">
        wire Z, PZ;
        assign Z = Z_JMP & Z_flag;
        assign PZ = PZ_JMP & PZ_flag; 
        </pre>      
        
        В тестбенче tR4.v<br>
        &bull; числа загружаются в ОЗУ <br>
        &bull; аккумулятор обнуляется <br>
        &bull; мультиплексор переключается <br>
        &bull; записанные в ОЗУ числа вычитаются из аккумулятора Acc <br>
        &bull; результат загружается в ОЗУ и в устройство вывода data_out <br>      
        <br>     
        в тестбенче tR4_jmp.v производится проверка перехода Z_JMP при положительном числе в аккумуляторе <br>
        <img align="center" src="tR4_jmp.gif"> 
        <br>     
        модуль и тестбенчи находятся <a href="https://github.com/demsp/verilog/tree/master/LMC/R4">здесь</a> <br>     
     </p>  
   </boby>  
 </html>  
