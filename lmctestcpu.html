<!DOCTYPE html>
 <html>
   <boby>
     <p>
       В данном проектируемом ЦПУ память комманд и память данных объединены в один массив RAM <br>
       К адресному входу памяти команд подключен двоичный счётчик, инкрементируемый тактовым сигналом и таким образом
       осуществляющий последовательный перебор команд <br>
       <pre style = "background: #cfffff;">
         counter <= counter + 1;  // инкремент счётчика
       </pre>
     Переходы осуществляются загрузкой в счётчик требуемого адреса <br>
     Загрузка осуществляется командой <i>counter_load</i> <br>
     <pre style="background: #cfffff;">
       wire [3..0] branch_adr; // адрес перехода
       assign branch_adr = data_in;
       // здесь для примера применяется КМОП таймер +3.3V
       always @(posedge timer555)
       begin
         if (Counter_load) // переход по адресу branch_adr при поступлени команды Counter_load
            counter <= branch_adr; 
          else
            counter <= counter + 1;// инкремент счётчика 
        end
     </pre>
    Устройство ввода <i>data_in</i> подключено ко входу двухвходового мультиплексора <i>MUX2</i> <br>
    К другому входу подключен сумматор <i>sum</i>
       <pre style="background: #cfffff;">
        assign sum = Acc + RAM;
       </pre>
    прибавляющий к аккумулятору числа, записанные в память <br>
    выход мультиплексора <i>MUX2</i> подключен к аккумулятору
    <pre style="background: #cfffff;">
     MUX2 = MUX_switch ? sum : data_in;
    </pre>
    Аккумулятор - это четырёхбитный регистр <br>
      <pre style="background: #cfffff;">
        module register4
        (
        input [3..0] reg_data,
        input reg_button,
        output reg [3..0] q 
        );
        always @(posedge reg_button)
          q <= reg_data;
        endmodule    
      </pre>
      порты которого подключены к основному модулю
       <pre style="background: #cfffff;">
       register4 Acc_reg(
         .reg_data(MUX2),
         .reg_button(Acc_button),
         .q(Acc)
       );
      </pre>
      Полный текст модуля (с подключеным аккумулятором) и тестбенч <a href=" https://github.com/demsp/verilog/blob/master/LMC/R3/">здесь</a> <br>     
      В тестбенче производится сложение двух чисел <br>
      1. Числа загружаются в RAM <br>       
      2. Аккумулятор обнуляется <br>
      3. Мультиплексор переключается <br>
      4. Первое число загружается из RAM в Acc <br>
      5. К этому числу прибавляется второе число <br>
      6. Сумма чисел загружается в RAM <br>
      <br>
      В следующем модуле добавляется "вычитатель" <br>
      <pre style="background: #cfffff;">
       wire [3..0] subtract;
       assign subtract = Acc - RAM;
      </pre>
     Двухвходовой мультиплексор заменяется четырёхвходовым <br>
        <pre style="background: #cfffff;">     
         always @*
         MUX4 = MUX_switch[1] ? (MUX_switch[0] ? RAM_out : subtract)
           :(MUX_switch[0] ? sum : data_in );
        </pre>
          К аккумулятору подключается устройство вывода <i>data_out</i>, а также флаги <br>
          Z_flag поднимается при условии Acc = 0 <br>   
          PZ_flag поднимается при условии Acc >= 0 <br>  
     </p>  
   </boby>  
 </html>  
